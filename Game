import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;

import javax.swing.JComponent;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.Timer;



public class Game extends JComponent implements KeyListener{
	protected Timer timer;
	protected Level level;
	protected int diffc=1;
	protected int score;
	protected int scoreTemp;
	protected int maxScoreInLevel;
	protected int keySpeed=5;
	public Game() {
		score=0;
		scoreTemp=0;
		maxScoreInLevel=0;
		this.addKeyListener(this);
		setFocusable(true);
		level=new Level(diffc);
		timer=new Timer(10,new TimerCallback());
		JOptionPane.showMessageDialog(null, "Welcome!\n Level 1");
		timer.start();
	}
	
	protected class TimerCallback implements ActionListener{
		@Override
	public void actionPerformed(ActionEvent arg0) {
			level.gameTimer.incrementTime();
			if (level.gameTimer.timeElapsed>=level.gameTimer.length) {
				scoreTemp=score;
				diffc++;
				JOptionPane.showMessageDialog(null, "You win!\n Your score: "+score+"\nNext level: Level"+diffc);
				level=new Level(diffc);
				level.gameTimer=new GameTimer(1500);
			}
			level.ball.nextMove();
			if (level.ball.score) {
				score+=10*diffc;
				level.ball.score=false;
			}
			if (level.ball.loose()) {
				level.lives-=1;
				if(level.lives>0) {
				level.ball.reset();
				level.gameTimer=new GameTimer(1500);
				 if(score>maxScoreInLevel) {
					 maxScoreInLevel=score;
				 }
				score=scoreTemp;
				}
				else
				{if(maxScoreInLevel<score) {maxScoreInLevel=score;}
				JOptionPane.showMessageDialog(null, "You loose! \n Your score:"+maxScoreInLevel+"\n Back to Level 1");
				score=0;
				scoreTemp=0;
				maxScoreInLevel=0;
				diffc=1;
				level=new Level(diffc);}
			}
			repaint();
	}}

public void paintComponent(Graphics g) {
	g.fillOval(level.ball.getX(),800-level.ball.gety(), 20, 20);
	g.fillRect(level.paddle.getPaddleX(), 600, level.paddle.getLength(), 10);
	level.gameTimer.drawTimer(g);
	g.drawString("Lives:"+Integer.toString(level.lives), 50, 50);
	g.drawString("Score: "+Integer.toString(score), 50, 100);
}

@Override
public void keyPressed(KeyEvent arg0) {
	keySpeed+=5;
	System.out.println(arg0.getKeyCode());
	switch(arg0.getKeyCode()) {
	case 68://D
		if(level.paddle.getPaddleX()<800-level.paddle.length)
		{level.paddle.setPaddleX(keySpeed);level.ball.setPaddleXInBall(level.paddle.paddlex);}
		else 
		{level.paddle.setAbsX(800-level.paddle.length);level.ball.setPaddleXInBall(level.paddle.paddlex);}
		break;
	case 65://A
		if(level.paddle.getPaddleX()>0)
		{level.paddle.setPaddleX(-keySpeed);level.ball.setPaddleXInBall(level.paddle.paddlex);}
		else
			{level.paddle.setAbsX(0);level.ball.setPaddleXInBall(level.paddle.paddlex);}
		break;
	default:
		//Ignore
	}
	level.ball.setPaddleXInBall(level.paddle.getPaddleX());
}

public static void main (String[] args) {
	JFrame frame=new JFrame("Lob Pong");
	Game canvas=new Game();
	frame.add(canvas);
	frame.setSize(800, 800);
	frame.setResizable(false);
	frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
	frame.setVisible(true);
}

@Override
public void keyReleased(KeyEvent e) {
	keySpeed=5;
}

@Override
public void keyTyped(KeyEvent e) {
}
}



